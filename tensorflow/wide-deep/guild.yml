# ===================================================================
# tensorflow.wide-deep package
# ===================================================================

- package: tensorflow.wide-deep
  version: 0.3.0
  description: Wide and deep income predictor for Census Income data
  url: https://github.com/guildai/index/tree/master/tensorflow/wide-deep
  maintainer: Guild AI
  maintainer-email: packages@guild.ai
  license: Apache 2.0
  tags:
    - wide-and-deep
    - census

# -------------------------------------------------------------------
# wide-deep-census
# -------------------------------------------------------------------

- model: wide-deep-census
  description: Wide and deep income predictor for Census Income data
  operations:
    prepare:
      description: Download and prepare the Census Income data
      cmd: wide_deep/data_download --data_dir data
      requires:
        - tensorflow.wide-deep/wide-deep-lib
    train:
      description: Train a wide and deep model on Census Income data
      cmd: wide_deep_patched --model_dir . --train_data data/adult.data --test_data data/adult.test
      flags:
        model-type:
          description: Model type (wide, deep, wide_deep)
          options:
            - value: wide
            - value: deep
            - value: wide_deep
        epochs:
          description: Number of training epochs
          value: 40
          arg-name: train_epochs
        epochs-per-eval:
          description: Number of training epochs to run between evaluations
          value: 2
        batch-size:
          description: Number of examples per batch
          value: 40
      requires:
        - tensorflow.wide-deep/wide-deep-lib
        - dataset
  resources:
    wide-deep-lib:
      description: Python library for tensorflow.wide-deep
      private: yes
      sources:
        - url: https://github.com/tensorflow/models/archive/v.1.6.0.zip
          sha256: ed8fd7066bb014feccaed2cd2a46e516468ef24c40be8ef21a96a09849db7ff5
          select: models-v.1.6.0/official/wide_deep
      post-process: >
        sed '/shutil.rmtree(FLAGS.model_dir/d' wide_deep.py > wide_deep_patched.py
    dataset:
      description: Prepared Census Income dataset
      private: yes
      sources:
        - operation: prepare
          select: data
