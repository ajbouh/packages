# -*-yaml-*-

name: slim-fine-tunable
extends: slim-base
private: yes

operations:
  fine-tune:
      description: Fine-tune {{model_label}}
      cmd: >
        slim_op train_image_classifier \
          --model_name {{model_name}} \
          --train_dir . \
          --dataset_split_name train \
          --dataset_dir data \
          --checkpoint_path {{model_name}}.ckpt \
          --checkpoint_exclude_scopes {{model_name}}/logits \
          --trainable_scopes {{model_name}}/logits
      flags: !load train-flags
      requires:
        - slim/models-lib
        - slim-datasets:${dataset}
        - checkpoint

resources:
  trained-model:
    description: Trained {{model_label}} model (train or fine-tune operation)
    path: model
    sources:
      - operation: train,fine-tune
        select: checkpoint|model\.ckpt.*
