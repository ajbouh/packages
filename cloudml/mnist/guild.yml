# ===================================================================
# cloudml.mnist package
# ===================================================================

- package: cloudml.mnist
  version: 0.3.1.dev2
  description: MNIST model for Cloud ML
  url: https://github.com/guildai/index/tree/master/cloudml/mnist
  author: Guild AI
  author-email: packages@guild.ai
  requires: []
  license: Apache 2.0
  tags: [cloudml, mnist, estimators, model]
  data-files: []

# -------------------------------------------------------------------
# mnist-cnn
# -------------------------------------------------------------------

- model: mnist-cnn
  description: CNN classifier for MNIST data
  operations:
    prepare:
      description: Prepare the MNIST data for training
      cmd: scripts/create_records --directory .
      flags:
        validation-size:
          description: >
            Number of examples to separate from the training data for
            the validation
          default: 5000
      requires: scripts
    train:
      description: Train the classifier locally
      cmd: trainer/task --data_dir . --output_dir .
      flags:
        train-batch-size:
          description: Batch size for training steps
          default: 100
          arg-name: train_batch_size
        eval-batch-size:
          description: Batch size for evaluation steps
          default: 100
          arg-name: eval_batch_size
        train-steps:
          description: Steps to run the training job for
          default: 10000
          arg-name: train_steps
        eval-steps:
          description: Number of steps to run evalution for at each checkpoint
          default: 100
          arg-name: eval_steps
      requires:
        - trainer
        - data
    cloudml-train:
      description: Train the classifier in Cloud ML
      plugin-op: cloudml-train
      flags:
        runtime-version:
          description: TensorFlow runtime version
          default: 1.2
    cloudml-deploy:
      description: Deploy a model to Cloud ML
      plugin-op: cloumld-deploy
      flags:
        runtime-version:
          description: TensorFlow runtime version
          default: 1.2
    prepare-request:
      description: Generate a sample request file
      cmd: scripts/make_request
      requires: scripts
    cloudml-predict:
      description: Send a prediction request to Cloud ML
      plugin-op: cloudml-predict
  resources:
    scripts:
      description: Supporting scripts
      private: yes
      sources:
        - url: https://github.com/GoogleCloudPlatform/cloudml-dist-mnist-example/archive/44ef5bcc8fda30ddd28c8f34d6ee4c0ef827d0e1.zip
          sha256: 94d4a7a1a0869454b3b843cdee1971982e0a2e07d7071c3bcb96a54ae5f29cc9
          select: cloudml-dist-mnist-example-44ef5bcc8fda30ddd28c8f34d6ee4c0ef827d0e1/scripts
    trainer:
      description: MNIST trainer
      private: yes
      sources:
        - url: https://github.com/GoogleCloudPlatform/cloudml-dist-mnist-example/archive/44ef5bcc8fda30ddd28c8f34d6ee4c0ef827d0e1.zip
          sha256: 94d4a7a1a0869454b3b843cdee1971982e0a2e07d7071c3bcb96a54ae5f29cc9
          select: cloudml-dist-mnist-example-44ef5bcc8fda30ddd28c8f34d6ee4c0ef827d0e1/trainer
    data:
      description: Prepared MNIST data
      sources:
        - operation: prepare
          select: .*\.tfrecords
