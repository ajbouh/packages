- config: retrain-support
  description: Provides TensorFlow Hub image retrain script
  resources:
    retrain-script:
      description: Transfer learning with image modules from TensorFlow Hub
      sources:
        - retrain.py

- config: hub-image-model
  description: Base config for TensorFlow Hub image models
  extends:
    - retrain-support
  params:
    image-dir: images
    train-summary-steps: 20
    eval-steps: 100
    checkpoint-steps: 1000
  operations:
    retrain:
      description: Retrain model with new images
      main:
        retrain
          --tfhub_module "{{tfhub-module}}"
          --image_dir "{{image-dir}}"
          --train_summary_interval {{train-summary-steps}}
          --eval_step_interval {{eval-steps}}
          --output_graph model/graph.pb
          --intermediate_output_graphs_dir model
          --intermediate_store_frequency {{checkpoint-steps}}
          --output_labels model/labels.txt
          --summaries_dir .
          --bottleneck_dir bottleneck
      requires:
        - retrain-script
        - images
      flags:
        train-steps:
          description: Number of steps to train
          default: 4000
          arg-name: how_many_training_steps
        learning-rate:
          description: Learning rate for training
          default: 0.01
          arg-name: learning_rate
        test-percent:
          description: Percent of images used to test
          default: 10
          arg-name: testing_percentage
        validate-percent:
          description: Percent of images used to validate
          default: 10
          arg-name: validation_percentage
        train-batch-size:
          description: Batch size used for training
          default: 100
          arg-name: train_batch_size
        test-batch-size:
          description: Batch size used for test; use -1 to test all images
          default: -1
          arg-name: test_batch_size
        validate-batch-size:
          description: Batch size used for validation
          default: 100
          arg-name: validation_batch_size
        flip-left-right:
          description: Whether to randomly flip half the images
          default: no
          arg-name: flip_left_right
        random-crop:
          description: Percent margin to randomly crop
          default: 0
          arg-name: random_crop
        random-scale:
          description: Percent of random scale
          default: 0
          arg-name: random_scale
        random-brightness:
          description: Percent brightness to randomly apply
          default: 0
          arg-name: random_brightness

- model: hub-inception-v3
  extends:
    - hub-image-model
  params:
    tfhub-module: https://tfhub.dev/google/imagenet/inception_v3/feature_vector/1

- config: flowers-dataset-support
  params:
    image-dir: flower_photos
  resources:
    images:
      description: Flowers images
      sources:
        - url: http://download.tensorflow.org/example_images/flower_photos.tgz
          select: flower_photos
